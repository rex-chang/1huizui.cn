---
title: "Golang 培训计划(01):前言"
date: 2019-08-24T14:41:28+08:00
draft: true
tags: ['golang', 'go']
toc: true
---

最近我司计划组织一次 `golang` 的培训, 所以将内容整理出来, 以供参考. 

内容大都参考过 **[七周七并发模型](https://item.jd.com/11668493.html)** 及 **[Go 语言圣经](<https://books.studygolang.com/gopl-zh/>)**, 感谢作者们的奉献.


<!--more-->

##  并发还是并行?

并发无处不在

### 串行

我们经常写这样子的代码:

```
http_request();
do_sth();
http_request();
do_sth2();   
```
代码顺序执行, 不会错, 不会乱.

### 并发还是并行?

引用 Rob Pike 的经典描述:

> 并发是同一时间应对(dealing with)多件事情的能力
> 
> 并行是同一时间动手做(doing)多件事情的能力.


**举个栗子?**


> 你吃饭吃到一半，电话来了，你一直到吃完了以后才去接，这就说明你不支持并发也不支持并行。

> 你吃饭吃到一半，电话来了，你停了下来接了电话，接完后继续吃饭，这说明你支持并发。（不一定是同时的）

> 你吃饭吃到一半，电话来了，你一边打电话一边吃饭，这说明你支持并行。  


并发的关键是你有处理多个任务的能力，不一定要**同时**。  

并行的关键是你有**同时**处理多个任务的能力。  

#### 并行架构

+ 位级并行

如果需要进行两个 32 位数的相加减, 8位的计算机需要进行多次 8 位的加减, 而 32 位的, 则可以一步完成. 

    8位机器: 任天堂(小霸王),

    16位机器: 80286

    32位机器: 80386 起

    64位机器: 安腾, AMD 的 Athlon 7

+ 指令级并行

    现代 CPU 的并行度很高, 其中使用的技术包括流水线, 乱序执行和猜测执行(动态分支预测)等.
    
    处理器内指令并行程度很高, 但是经过精心设计, 从外部看上去, 所有的处理都像是串行的.

+ 数据级并行

    常见的 SIMD(单指令多数据)/SIMT(单指令多线程, 多用于显卡), 可以并行地在大量数据上施加同一操作. 在特定场景下可以发挥巨大的作用, 比如说图像渲染, 深度学习也会用到.
    
+ 任务级并行

    多处理器并行, 从我们的角度来看, 多处理器架构最明显的分类特征是其内存模型(共享内存或者分布式内存)


#### 并发

使用并发的目的, 不仅仅是让程序并行运行并发挥多核的优势, 若正确使用并发, 程序还将获取以下优点: 及时响应, 高效, 容错, 简单.

#### 并发场景

在我们的系统里面, 经常出现的并发场景

##### 并发读

接口调用, 多数情况下在`任务级并发`的情况下可以应对, 我们常见的优化手段: 加机器, 加缓存, 优化调用链路. 惟快不破.

##### 并发写

主要存在于学习系统学生提交做题答案, 消息队列的生产和消费.

对应的解决方案:

1. 一写多读, 保证数据的最终一致性

2. 对于不需要累加的数据, 使用计数器, 来保证旧的数据不会覆盖新的

#### 常见的并发模块

1. 线程与锁:
2. Clojure之道--分离标识和状态
3. Actor: 应用广泛, 适用于共享内存行和分布式内存型模块, 能提供强大的容错性
4. CPS(通信顺序进行): 和 `Actor` 很相似, 都是基于消息传递, 但`CSP`侧重于消息传递的通道, `Actor` 则更侧重于消息两端的实体.
5. 数据级并行(GPU), 图像/视频的 `GPU` 加速.
6. Lambad 架构: 一种可以处理多种大数据问题的架构, 综合了 `MapReduce` 和流式处理的特点.

### 扩展资料

[CPU原子集指令](https://www.infoq.cn/article/atomic-operation)